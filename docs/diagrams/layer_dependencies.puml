@startuml layer_dependencies
!theme plain
skinparam linetype ortho
skinparam nodesep 80
skinparam ranksep 100

title 5-Layer Architecture\nHexagonal (Ports & Adapters) + Clean + DDD

package "Bootstrap Layer" as Bootstrap #FFEBCD {
  note right of Bootstrap
    **Composition Root**
    - Wires all dependencies
    - **Static dispatch via generics**
    - Application lifecycle
    - Can depend on ALL layers
  end note
}

package "Presentation Layer" as Presentation #FFE4E1 {
  component "CLI" as CLI
  component "Commands" as Commands
  note right of Presentation
    **Driving Adapters**
    - User interfaces (CLI, API)
    - Request/response mapping
    - **Depends ONLY on Application**
    - **CANNOT access Domain**
  end note
}

package "Infrastructure Layer" as Infrastructure #E6F3FF {
  component "Adapters" as Adapters
  component "Console Writer" as ConsoleWriter
  note right of Infrastructure
    **Driven Adapters**
    - Implements Output Ports
    - External system integration
    - Depends on Application + Domain
  end note
}

package "Application Layer" as Application #E8F5E9 {
  component "Use Cases" as UseCases
  component "Ports" as Ports
  component "application/error" as AppError #FFFF99
  note right of Application
    **Orchestration Layer**
    - Coordinates domain logic
    - Defines Input/Output Ports
    - Re-exports Domain types
    - **Depends ONLY on Domain**
  end note
  note bottom of AppError
    Re-exports domain/error
    for Presentation layer
  end note
}

package "Domain Layer" as Domain #FFF9E6 {
  component "Value Objects" as VOs
  component "domain/error" as DomainError
  component "Result[T]" as Result
  note right of Domain
    **Business Logic Core**
    - Pure domain concepts
    - ZERO external module deps
    - Shareable across apps
  end note
}

' Dependencies - ALL point INWARD (center-seeking)
Bootstrap -down-> Presentation : wires
Bootstrap -down-> Infrastructure : wires
Bootstrap -down-> Application : wires
Bootstrap -down-> Domain : wires

Presentation -down-> Application : calls Input Ports\nuses application/error
Presentation -[hidden]down-> Domain

Infrastructure -down-> Application : implements Output Ports
Infrastructure -down-> Domain : uses Value Objects

Application -down-> Domain : orchestrates

' Critical boundaries
note on link
  ✅ ALLOWED
  Uses application/error
  (not domain/error)
end note

' Forbidden dependency
Presentation .right.> Domain #red : ❌ FORBIDDEN\nNo transitive access

legend right
  **Key Architectural Rules**
  ═══════════════════════════════
  ✅ **Presentation → Application ONLY**
     (no transitive Domain access)
  ✅ Infrastructure → Application + Domain
  ✅ Application → Domain
  ✅ Bootstrap → ALL (composition root)

  ❌ **NO** Presentation → Domain
  ❌ **NO** Presentation ↔ Infrastructure
  ❌ **NO** Domain → anything

  **Domain is the ONLY shareable layer**
  across multiple applications
endlegend

@enduml
